# Sampling

A Java library for sampling of large data streams using small memory.

## Build

To build run the `build` script (`.sh` for Linux-based and `.bat` for Windows).

## CLI

```
java -jar Sampling.jar <command> [<argument>]...
```

### Example

```
java -jar Sampling.jar sample Distinct -n=42 -hLinear --seed 42 --in=data/updates.txt
```

### Test data generation [`gen`]

```
java -jar Sampling.jar gen <format> <domain size> <# of updates>
```

|        Option       | Description                                                       |
| :-----------------: | :---------------------------------------------------------------- |
|  `--out, -o <path>` | Outputs to the given file instead of the standard output.         |
| `--seed, -s <seed>` | Sets the generator seed. If not specified, it is chosen randomly. |

If you use the character `n` as the number of updates, each index will get only one update with the final frequency.

The generated data then can be read for sampling with the `--gen` flag.

#### Available formats

- Units: Each index has final frequency around one.
- UnitsAndRoots: There are about √n indices with frequency around √n, the rest are around one.
- Outlier: There is one index with frequency around n, the rest are around one.
- Uniform: Each update uniformly choses an index and a value between 0 and √n.
- PowerLaw: The final frewuencies follow the power law.

### Running samplers [`sample`]

```
java -jar Sampling.jar sample <sampler> [<argument>]...
```

|          Option         | Description                                                               |
| :---------------------: | :------------------------------------------------------------------------ |
|    `--in, -i <path>`    | Reads updates from the given file instead of the standard input.          |
|    `--out, -o <path>`   | Outputs to the given file instead of the standard output.                 |
|    `--period, -P <p>`   | Prints query every *p* updates. If not specified, prints only at the end. |
| `--domain-size, -n <n>` | Sets the domain size.                                                     |
|  `--delta, -d, -δ <δ>`  | Sets the sampler delta (δ). Default is 0.01 (1%).                         |
| `--epsilon, -e, -ε <ε>` | Sets the sampler epsilon (ε). Default is 0.01 (1%).                       |
|    `--prime, -p <p>`    | Sets the prime number used for hashing and similar purposes.              |
|   `--hash, -h <hash>`   | Sets the hash function. If not specified, MurmurHash is used.             |
|   `--seed, -s <seed>`   | Sets the sampler seed. If not specified, it is chosen randomly.           |
|       `--gen, -g`       | Consumes generated test data.                                             |
|    `--k-mer, -k <k>`    | Reads FASTA files and samples *k*-mers.                                   |

For standard mode (no `-g` or `-x`) you have to specify the domain size (`-n`).
The input is interpreted as a (textual) stream of white space separated updates.
Each update consists of the (zero based) index of an item followed by the change to its frequency.

#### Available samplers

- Distinct
- Precision
- TrulyPerfectL2

#### Available hash functions

- Linear
- Murmur
- MultiplyShift
- Tabulation

### Testing samplers [`test`]

```
java -jar Sampling.jar test <sampler> <data> [<argument>]...
```

Data can be a file generated by `gen` or a directory of them.

|           Option          | Description                                                                                                  |
| :-----------------------: | :----------------------------------------------------------------------------------------------------------- |
|     `--out, -o <path>`    | Outputs to the given file instead of the standard output.                                                    |
|        `--time, -t`       | Prints how long the updates and the query took.                                                              |
|    `--distribution, -D`   | Prints the expected and actual distributions. (Not recommended for large domain sizes.)                      |
|   `--delta, -d, -δ <δ>`   | Sets the sampler delta (δ). Default is 0.01 (1%).                                                            |
|  `--epsilon, -e, -ε <ε>`  | Sets the sampler epsilon (ε). Default is 0.01 (1%).                                                          |
|     `--prime, -p <p>`     | Sets the prime number used for hashing and similar purposes.                                                 |
|    `--hash, -h <hash>`    | Sets the hash function. If not specified, MurmurHash is used.                                                |
|    `--seed, -s <seed>`    | Sets the seed used to derive seeds for individual samplers. If not specified, each sampler chooses randomly. |
| `--samplers, -m <number>` | Sets the number of samplers run on each file. Default is 1000.                                               |
|   `--buffer, -b <size>`   | Sets how many updates are read from the file before being executed. Default is 1000000.                      |